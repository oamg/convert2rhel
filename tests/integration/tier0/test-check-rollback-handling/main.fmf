summary: Verify rollback correct behavior
description: |
    Terminate conversion at various points and verify that the rollback finishes successfully.
    Verify that packages unnecessary packages are backed up and not removed.

adjust+:
    - environment+:
        PROMPT_AMOUNT: 4
      when: distro == oraclelinux
    - environment+:
        PROMPT_AMOUNT: 5
      when: distro == centos
      because: |
        There is one more user prompt asking for removal of python[3]?-syspurpose

tier: 0

tag+:
    - nondestructive
    - rollback
    - check-rollback-handling

/rhsm_cleanup:
    tag+:
        - rhsm-cleanup
    test: |
        pytest -svv -m rhsm_cleanup

/packages_untracked_graceful_rollback:
    tag+:
        - packages-untracked-graceful-rollback
    test: |
        pytest -svv -m packages_untracked_graceful_rollback

/packages_untracked_forced_rollback:
    tag+:
        - packages-untracked-forced-rollback
    test: |
        pytest -svv -m packages_untracked_forced_rollback

/terminate_on_registration:
    tag+:
        - terminate-on-registration
    test: |
        pytest -svv -m terminate_on_registration

/terminate_on_username:
    tag+:
        - terminate-on-username
    test: |
        pytest -svv -m terminate_on_username

/terminate_on_password:
    tag+:
        - terminate-on-password
    test: |
        pytest -svv -m terminate_on_password

/terminate_on_subscription:
    tag+:
        - terminate-on-subscription
    test: |
        pytest -svv -m terminate_on_subscription
